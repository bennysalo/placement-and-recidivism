---
title: "Analyses and figures"
output: html_notebook
date: 2018-01-22
---

In this part of the analyses we do the logistic regression analyses and plot the results.

# Function for logistic regressions

Here we write a function that takes the list of results previously compiled (data and matching results) and adds logistic regression results. We perform two logistic regression analyses:
1. An ancova style analysis with the effect of the independent variable controlled by the propensity score
2. Extending this with an interaction effect to test the assumption of "parallel lines".

Estimated probabilities from 2) will be used in the plots. 

```{r}

add_glm_tests <- function(results_list) {
  if (results_list$effect_variable == "openPrison") {         # open placement
    f_ancova      <- "reoffenceThisTerm ~ openPrison + propensity_open_logit"
    f_interaction <- "reoffenceThisTerm ~ openPrison * propensity_open_logit"
    
  } else if (results_list$effect_variable == "conditionalReleaseGranted"){         # conditional release
    f_ancova      <- "reoffenceThisTerm ~ conditionalReleaseGranted + propensity_cond_logit"
    f_interaction <- "reoffenceThisTerm ~ conditionalReleaseGranted * propensity_cond_logit"
    
  } else if (results_list$effect_variable == "supervisedParole") {         #  parole supervised
    f_ancova      <- "reoffenceThisTerm ~ supervisedParole + propensity_superv_logit"
    f_interaction <- "reoffenceThisTerm ~ supervisedParole * propensity_superv_logit"
  } else {
    warning('Could not specificy effect')
  }
  
  used_data <- results_list$data[results_list$data$matched == 1, ]
  
  results_list$glm_ancova      <- glm(f_ancova,      
                                          family = binomial, data = used_data)
  results_list$glm_interaction <- glm(f_interaction, 
                                          family = binomial, data = used_data)

  return(results_list)
}


```

Use this function on the results lists.

```{r}
op_cr0_ps0 <- add_glm_tests(op_cr0_ps0)
op_cr0_ps1 <- add_glm_tests(op_cr0_ps1)

cr_op1_ps0 <- add_glm_tests(cr_op1_ps0)
cr_op1_ps1 <- add_glm_tests(cr_op1_ps1)
  
ps_op0_cr0 <- add_glm_tests(ps_op0_cr0)
ps_op1_cr0 <- add_glm_tests(ps_op1_cr0)
ps_op1_cr1 <- add_glm_tests(ps_op1_cr1)

```




